# ğŸ“‘ PROJECT SUMMARY â€“ CECIÂ AI BOT CHAIN

> **Purpose (EN)** â€“ Lightweight, alwaysâ€‘loaded overview for Claude: explains what the project does, where the critical instructions live, and how to read them *only when needed* to save tokens.
>
> **××˜×¨×” (×¢×‘×¨×™×ª)** â€“ ×ª×§×¦×™×¨ ×§×•××¤×§×˜×™ ×©â€‘Claude ×˜×•×¢×Ÿ ×‘×ª×—×™×œ×ª ×›×œ ×©×™×—×”, ×¢× ××¤×•×ª ×§×‘×¦×™× ×•×”× ×—×™×•×ª ×§×¨×™××” ×××•×§×“×ª ×œ×—×™×¡×›×•×Ÿ ×‘×˜×•×§× ×™×.

---

## 1 Â· What the System Does â©

*Answer complex Hebrew queries about Israeli government decisions.*

1. **Frontend** sends `POSTÂ /api/process-query` with freeâ€‘text Hebrew.
2. **Backend** proxies the payload to a single **BOTÂ CHAIN** container (portÂ 8002).
3. **BOTÂ CHAIN** runs **7 GPT bots** in sequence:
   `0_REWRITEÂ â†’Â 1_INTENTÂ â†’Â 2X_ROUTERÂ â†’Â 2C_CLARIFY?Â â†’Â 2Q_SQLÂ â†’Â 2E_EVALÂ â†’Â 3Q_RANK`.
4. A **Formatter code module** (nonâ€‘GPT) formats the ranked rows into Markdown / JSON and returns the answer.
5. Data source is **Supabase PostgreSQL** (`israeli_government_decisions_*` tables).

ğŸ‘‰ *No SQL engine any more â€“ BOTÂ CHAIN replaced it transparently.*

---

## 2 Â· Directory Landmarks ğŸ“‚

| Path                                        | What lives here                                        | When to read                                                                                        |
| ------------------------------------------- | ------------------------------------------------------ | --------------------------------------------------------------------------------------------------- |
| `bot_chain/ARCHITECTURE.md`                 | Full system architecture (mermaid, ports, flows)       | **Overview only** â€“ skim for context.                                                               |
| `bot_chain/LAYERS_SPECS/`                   | **7 individual bot specs** (prompt, examples, weights) | **Load *only* the spec of the layer in focus**.<br>e.g. handling rewrite â†’ read `0_REWRITE_BOT.md`. |
| `bot_chain/MICRO_LEVEL_GUIDE.md`                      | Crossâ€‘layer principles (naming, scoring, security)     | Reference for *any* layer deep dive.                                                                |
| `bot_chain/LAYERS_SPECS/SQL_DB_SPEC.md`                            | Whitelisted tables/columns & RLS notes                 | Read when crafting / debugging SQL.                                                                 |
| `bot_chain/LAYERS_SPECS/end2End_scenarios.md`                      | Sample user journeys & expected outputs                | Use for regression tests.                                                                           |
| `bot_chain/LAYERS_SPECS/israeli_government_decisions_DB_SCHEME.md` | PostgreSQL schema diagram                              | Needed only for new SQL joins.                                                                      |

> ğŸ”– **Rule of Thumb** â€“ *If you are interacting with or modifying a single bot layer, read:*<br>Â Â 1. That layerâ€™s spec (one file).<br>Â Â 2. The `MICRO_LEVEL_GUIDE` for common rules.<br>Â Â 3. Skip everything else unless explicitly required.

---

## 3 Â· Tokenâ€‘Saving Guidelines ğŸª™

1. **Minimal Context Loading** â€“ Never ingest the entire repo. Pick the smallest relevant doc(s).
2. **Layer Isolation** â€“ Each bot spec is selfâ€‘contained; do not preload specs for other layers.
3. **Debug Info** â€“ Use `debug_info.token_usage` returned from BOTÂ CHAIN to monitor consumption.
4. **Formatter** uses **no GPT tokens** â€“ keep heavy postâ€‘processing logic in code.

---

## 4 Â· QuickÂ Reference âœï¸

| Need                    | Open this                                            |
| ----------------------- | ---------------------------------------------------- |
| Understand overall flow | `ARCHITECTURE_BOT_CHAIN.md` (SectionÂ 2 Runtime Flow) |
| Check REST contract     | `ARCHITECTURE_BOT_CHAIN.md` (SectionÂ 4)              |
| Tune a prompt           | `bot_chain/LAYERS_SPECS/<layer>.md`                  |
| Validate DB columns     | `SQL_DB_SPEC.md` + `*_DB_SCHEME.md`                  |
| Estimate cost           | Token budget table (ArchitectureÂ Â§8)                 |

---

## 5 Â· Contact

*Maintainer*: **Tomer** â€“ [tomer@example.com](mailto:tomer@example.com)

---

*Loaded at conversation start â€“ keep it short & actionable.*
